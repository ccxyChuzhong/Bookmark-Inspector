<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>书签导入功能测试</title>
  <link rel="stylesheet" href="./css/styles.css">
  <link rel="stylesheet" href="./css/bootstrap-icons.css">
</head>
<body>
  <div class="container">
    <header class="header">
      <h1><i class="bi bi-bookmark-star"></i> 书签导入功能测试</h1>
    </header>
    
    <main class="main-content">
      <section class="action-panel">
        <div class="action-buttons">
          <div class="button-row">
            <button id="importBtn" class="btn primary-btn full-width" type="button">
              <i class="bi bi-upload"></i> 选择文件导入
            </button>
            <input type="file" id="importFile" accept=".json,.html,.csv,.md" style="display:none;">
          </div>
          
          <!-- 导入设置区域 -->
          <div class="import-settings">
            <div class="setting-group">
              <label for="importTargetFolder" class="setting-label">导入到文件夹：</label>
              <select id="importTargetFolder" class="folder-select" title="选择导入目标文件夹" aria-label="选择导入目标文件夹">
                <option value="1">书签栏</option>
                <option value="test-folder">测试文件夹</option>
              </select>
            </div>
            <div class="setting-group">
              <label for="importMode" class="setting-label">导入方式：</label>
              <select id="importMode" class="import-mode-select" title="选择导入方式" aria-label="选择导入方式">
                <option value="flatten">平铺模式（所有书签导入到根目录）</option>
                <option value="preserve">保持结构（保持原有文件夹结构）</option>
              </select>
            </div>
          </div>
        </div>
      </section>
      
      <section class="notification-area">
        <div id="message" class="message"></div>
      </section>
      
      <section id="testResults" class="check-results">
        <h3>测试结果：</h3>
        <div id="testOutput"></div>
      </section>
    </main>

    <footer class="footer">
      <div class="footer-content">
        <small>书签导入功能测试页面</small>
      </div>
    </footer>
  </div>

  <!-- 导入设置模态对话框 -->
  <div id="importModal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3><i class="bi bi-upload"></i> 导入书签设置</h3>
        <button id="closeModal" class="close-btn" type="button">&times;</button>
      </div>
      <div class="modal-body">
        <div class="setting-group">
          <label for="importTargetFolder" class="setting-label">导入到文件夹：</label>
          <select id="importTargetFolder" class="folder-select" title="选择导入目标文件夹" aria-label="选择导入目标文件夹">
            <option value="1">书签栏</option>
            <option value="test-folder">测试文件夹</option>
          </select>
        </div>
        <div class="setting-group">
          <label for="importMode" class="setting-label">导入方式：</label>
          <select id="importMode" class="import-mode-select" title="选择导入方式" aria-label="选择导入方式">
            <option value="flatten">平铺模式（所有书签导入到根目录）</option>
            <option value="preserve">保持结构（保持原有文件夹结构）</option>
          </select>
        </div>
        <div class="mode-description">
          <p id="modeDescription">平铺模式：将JSON文件中的所有书签提取出来，全部导入到选中文件夹的根目录下，不保持原有的文件夹结构。</p>
        </div>
      </div>
      <div class="modal-footer">
        <button id="cancelImport" class="btn secondary-btn" type="button">
          <i class="bi bi-x-circle"></i> 取消
        </button>
        <button id="confirmImport" class="btn primary-btn" type="button">
          <i class="bi bi-check-circle"></i> 选择文件
        </button>
      </div>
    </div>
  </div>
  
  <script>
    // 模拟Chrome书签API
    window.chrome = {
      bookmarks: {
        create: function(bookmark) {
          return new Promise((resolve) => {
            console.log('创建书签:', bookmark);
            const testOutput = document.getElementById('testOutput');
            const div = document.createElement('div');
            div.style.padding = '5px';
            div.style.borderBottom = '1px solid #eee';
            if (bookmark.url) {
              div.innerHTML = `📄 书签: ${bookmark.title} -> ${bookmark.url} (父文件夹: ${bookmark.parentId})`;
            } else {
              div.innerHTML = `📁 文件夹: ${bookmark.title} (父文件夹: ${bookmark.parentId})`;
            }
            testOutput.appendChild(div);
            resolve({ id: 'mock-id-' + Date.now() });
          });
        }
      }
    };
    
    // 显示消息函数
    function showMessage(text, isError = false) {
      const messageElement = document.getElementById("message");
      if (!messageElement) return; 
      
      const notificationArea = document.querySelector(".notification-area");
      if (notificationArea) {
        notificationArea.style.display = "block";
      }
      messageElement.textContent = text;
      messageElement.className = "message" + (isError ? " error" : " success");
      setTimeout(() => {
        if (document.body.contains(messageElement)) {
          messageElement.textContent = "";
          messageElement.className = "message";
          if (notificationArea) {
            notificationArea.style.display = "none";
          }
        }
      }, 3000);
    }
  </script>
  <script src="./js/popup.js"></script>
</body>
</html>
